-- schema.sql
-- Удаляем и создаем базу заново
-- psql -U postgres -d computer_shop -f schema.sql
DROP SCHEMA public CASCADE;
CREATE SCHEMA public;

-- Создание таблицы users
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  first_name TEXT NOT NULL,
  last_name TEXT NOT NULL,
  middle_name TEXT,
  email TEXT UNIQUE NOT NULL,
  phone TEXT UNIQUE,
  city TEXT,
  role TEXT DEFAULT 'user'
);

-- Создание таблицы products
CREATE TABLE products (
  id SERIAL PRIMARY KEY,
  name TEXT NOT NULL,
  description TEXT,
  price NUMERIC(10, 2) NOT NULL,
  characteristics JSONB
);

-- Создание таблицы cart
CREATE TABLE cart (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id) ON DELETE CASCADE,
  product_id INTEGER REFERENCES products(id) ON DELETE CASCADE,
  quantity INTEGER NOT NULL DEFAULT 1,
  UNIQUE(user_id, product_id)
);

-- Тестовые пользователи
INSERT INTO users (first_name, last_name, middle_name, email, phone, city, role)
VALUES
  ('Иван', 'Иванов', 'Иванович', 'ivan@example.com', '89001234567', 'Москва', 'admin'),
  ('Петр', 'Петров', 'Петрович', 'petr@example.com', '89007654321', 'Санкт-Петербург', 'user'),
  ('Анна', 'Сидорова', 'Александровна', 'anna@example.com', '89005555555', 'Екатеринбург', 'user');

-- Большой набор тестовых товаров
INSERT INTO products (name, description, price, characteristics)
VALUES
  (
    'Игровой ноутбук ASUS ROG Strix G15',
    'Мощный игровой ноутбук с процессором AMD Ryzen 7 и видеокартой RTX 3060',
    129990.00,
    '{"ОЗУ": "16ГБ DDR4", "Процессор": "AMD Ryzen 7 5800H", "Графика": "NVIDIA RTX 3060", "Диск": "1ТБ SSD", "Экран": "15.6 144Hz"}'
  ),
  (
    'Монитор Samsung Odyssey G7 27"',
    'Изогнутый игровой монитор с высокой частотой обновления',
    42990.00,
    '{"Размер": "27 дюймов", "Тип": "VA", "Частота": "240Гц", "Разрешение": "2560x1440", "Изогнутость": "1000R"}'
  ),
  (
    'Клавиатура механическая Razer BlackWidow V3',
    'Механическая клавиатура с RGB подсветкой и переключателями Green',
    8990.00,
    '{"Тип": "Механическая", "Переключатели": "Razer Green", "Подсветка": "RGB", "Подключение": "USB-C"}'
  ),
  (
    'Мышь Logitech G Pro X Superlight',
    'Беспроводная игровая мышь с датчиком HERO 25K',
    13990.00,
    '{"Тип": "Беспроводная", "Датчик": "HERO 25K", "Вес": "63г", "Батарея": "70 часов"}'
  ),
  (
    'Видеокарта NVIDIA GeForce RTX 4070',
    'Современная видеокарта для игр в 1440p с поддержкой ray tracing',
    84990.00,
    '{"Память": "12ГБ GDDR6X", "Архитектура": "Ada Lovelace", "Разъемы": "3x DisplayPort, 1x HDMI", "Мощность": "200W"}'
  ),
  (
    'Процессор Intel Core i7-13700K',
    'Высокопроизводительный процессор для игр и работы',
    41990.00,
    '{"Ядра": "16 (8P+8E)", "Потоки": "24", "Частота": "3.4-5.4 ГГц", "Сокет": "LGA1700", "Кэш": "30МБ"}'
  ),
  (
    'Материнская плата ASUS ROG Strix Z790-E',
    'Игровая материнская плата с поддержкой DDR5 и PCIe 5.0',
    34990.00,
    '{"Сокет": "LGA1700", "Чипсет": "Z790", "Память": "DDR5-5600", "Слоты": "4x DIMM", "Разъемы": "WiFi 6E, USB 3.2"}'
  ),
  (
    'Оперативная память Corsair Vengeance LPX 32ГБ',
    'Высокоскоростная память DDR4 для игр и профессиональных задач',
    12990.00,
    '{"Объем": "32ГБ (2x16ГБ)", "Тип": "DDR4", "Частота": "3200МГц", "Тайминги": "16-18-18-36", "Профиль": "XMP 2.0"}'
  ),
  (
    'SSD накопитель Samsung 980 PRO 1ТБ',
    'Быстрый NVMe SSD для загрузки системы и игр',
    11990.00,
    '{"Объем": "1ТБ", "Интерфейс": "PCIe 4.0 x4", "Скорость чтения": "7000 МБ/с", "Скорость записи": "5000 МБ/с", "Форм-фактор": "M.2 2280"}'
  ),
  (
    'Блок питания Corsair RM850x',
    'Модульный блок питания 80+ Gold с тихой работой',
    15990.00,
    '{"Мощность": "850Вт", "Сертификат": "80+ Gold", "Модульность": "Полная", "Вентилятор": "135мм", "Гарантия": "10 лет"}'
  ),
  (
    'Корпус Fractal Design Define 7',
    'Тихий корпус среднего размера с отличной вентиляцией',
    19990.00,
    '{"Тип": "Midi Tower", "Материал": "Сталь", "Вентиляторы": "3x 140мм", "Отсеки": "2x 5.25, 8x 2.5/3.5", "Размер": "543x233x465мм"}'
  ),
  (
    'Кулер для процессора Noctua NH-D15',
    'Высокопроизводительный воздушный кулер с двумя вентиляторами',
    9990.00,
    '{"Тип": "Воздушное", "Вентиляторы": "2x 140мм", "Сокеты": "Intel/AMD", "Высота": "165мм", "Шум": "до 24.6 дБ"}'
  ),
  (
    'Веб-камера Logitech C920s HD Pro',
    'Full HD веб-камера с автофокусом для стриминга',
    7990.00,
    '{"Разрешение": "1080p", "Частота": "30fps", "Автофокус": "Да", "Микрофон": "Стерео", "Подключение": "USB-A"}'
  ),
  (
    'Наушники SteelSeries Arctis 7',
    'Беспроводные игровые наушники с объемным звуком',
    16990.00,
    '{"Тип": "Беспроводные", "Драйверы": "40мм", "Частота": "20-20000 Гц", "Батарея": "24 часа", "Микрофон": "Выдвижной"}'
  ),
  (
    'Колонки Logitech Z623',
    'Мощная акустическая система 2.1 с сабвуфером',
    8990.00,
    '{"Тип": "2.1", "Мощность": "200Вт", "Сабвуфер": "130Вт", "Сателлиты": "35Вт x2", "Подключение": "3.5мм, RCA"}'
  );

-- Тестовые товары в корзине
INSERT INTO cart (user_id, product_id, quantity)
VALUES
  (1, 1, 1),
  (1, 2, 1),
  (2, 3, 2),
  (2, 4, 1);

-- Комментируем код для дополнительного заполнения БД
/*
-- Дополнительные товары (раскомментировать при необходимости)
INSERT INTO products (name, description, price, characteristics)
VALUES
  (
    'Игровое кресло DXRacer King Series',
    'Профессиональное игровое кресло с поддержкой поясницы',
    29990.00,
    '{"Материал": "Экокожа", "Высота": "125-135см", "Вес": "до 150кг", "Подлокотники": "4D", "Колеса": "Полиуретан"}'
  ),
  (
    'Коврик для мыши SteelSeries QcK XXL',
    'Большой игровой коврик из ткани',
    2990.00,
    '{"Размер": "900x400мм", "Толщина": "4мм", "Материал": "Ткань", "Основа": "Резина"}'
  ),
  (
    'Внешний жесткий диск WD Black P10 4ТБ',
    'Портативный игровой накопитель большой емкости',
    12990.00,
    '{"Объем": "4ТБ", "Интерфейс": "USB 3.2", "Скорость": "до 130 МБ/с", "Совместимость": "PC, PS4, Xbox"}'
  );
*/