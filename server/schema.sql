-- schema.sql
-- Удаляем и создаем базу заново
--psql -U postgres -d computer_shop -f schema.sql
DROP SCHEMA public CASCADE;
CREATE SCHEMA public;

-- Создание таблицы users
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  first_name TEXT NOT NULL,
  last_name TEXT NOT NULL,
  middle_name TEXT,
  email TEXT UNIQUE NOT NULL,
  phone TEXT,
  city TEXT,
  role TEXT DEFAULT 'user'
);

-- Создание таблицы products
CREATE TABLE products (
  id SERIAL PRIMARY KEY,
  name TEXT NOT NULL,
  description TEXT,
  price NUMERIC(10, 2) NOT NULL,
  characteristics JSONB -- ключ: значение, например: {"ОЗУ": "8ГБ", "Процессор": "Intel i5"}
);

-- Создание таблицы cart_items
CREATE TABLE cart_items (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id) ON DELETE CASCADE,
  product_id INTEGER REFERENCES products(id) ON DELETE CASCADE,
  quantity INTEGER NOT NULL DEFAULT 1,
  UNIQUE(user_id, product_id)
);

-- Пример тестовых данных пользователей
INSERT INTO users (first_name, last_name, middle_name, email, phone, city, role)
VALUES
  ('Иван', 'Иванов', 'Иванович', 'ivan@example.com', '89001234567', 'Москва', 'admin'),
  ('Петр', 'Петров', 'Петрович', 'petr@example.com', '89007654321', 'Санкт-Петербург', 'user'),
  ('Анна', 'Сидорова', 'Александровна', 'anna@example.com', '89123456789', 'Екатеринбург', 'user'),
  ('Михаил', 'Козлов', 'Викторович', 'mikhail@example.com', '89876543210', 'Новосибирск', 'user');

-- Заполнение БД компьютерными комплектующими
INSERT INTO products (name, description, price, characteristics)
VALUES
  -- Процессоры
  (
    'Intel Core i5-13600K',
    'Мощный 14-ядерный процессор для игр и работы',
    29990.00,
    '{"Ядра": "14", "Потоки": "20", "Базовая частота": "3.5 ГГц", "Турбо частота": "5.1 ГГц", "Сокет": "LGA1700"}'
  ),
  (
    'AMD Ryzen 7 7700X',
    'Высокопроизводительный 8-ядерный процессор',
    27990.00,
    '{"Ядра": "8", "Потоки": "16", "Базовая частота": "4.5 ГГц", "Турбо частота": "5.4 ГГц", "Сокет": "AM5"}'
  ),
  (
    'Intel Core i7-13700K',
    'Топовый процессор для энтузиастов',
    39990.00,
    '{"Ядра": "16", "Потоки": "24", "Базовая частота": "3.4 ГГц", "Турбо частота": "5.4 ГГц", "Сокет": "LGA1700"}'
  ),
  
  -- Видеокарты
  (
    'NVIDIA GeForce RTX 4070',
    'Мощная видеокарта для 1440p гейминга',
    59990.00,
    '{"Память": "12 ГБ GDDR6X", "Шина памяти": "192 бит", "Базовая частота": "1920 МГц", "Boost частота": "2475 МГц"}'
  ),
  (
    'AMD Radeon RX 7800 XT',
    'Отличная видеокарта для высоких настроек',
    54990.00,
    '{"Память": "16 ГБ GDDR6", "Шина памяти": "256 бит", "Базовая частота": "2124 МГц", "Boost частота": "2430 МГц"}'
  ),
  (
    'NVIDIA GeForce RTX 4080',
    'Премиальная видеокарта для 4K гейминга',
    99990.00,
    '{"Память": "16 ГБ GDDR6X", "Шина памяти": "256 бит", "Базовая частота": "2205 МГц", "Boost частота": "2505 МГц"}'
  ),
  
  -- Материнские платы
  (
    'ASUS PRIME B760M-A',
    'Надежная материнская плата для Intel',
    8990.00,
    '{"Сокет": "LGA1700", "Чипсет": "B760", "Форм-фактор": "micro-ATX", "Слоты памяти": "4", "Максимум ОЗУ": "128 ГБ"}'
  ),
  (
    'MSI MAG B650 TOMAHAWK',
    'Игровая материнская плата для AMD',
    14990.00,
    '{"Сокет": "AM5", "Чипсет": "B650", "Форм-фактор": "ATX", "Слоты памяти": "4", "Максимум ОЗУ": "128 ГБ"}'
  ),
  
  -- Оперативная память
  (
    'Kingston FURY Beast 16GB DDR4',
    'Быстрая игровая память DDR4',
    4990.00,
    '{"Объем": "16 ГБ", "Тип": "DDR4", "Частота": "3200 МГц", "Тайминги": "CL16", "Количество модулей": "2x8 ГБ"}'
  ),
  (
    'Corsair Vengeance LPX 32GB DDR4',
    'Профессиональная память большого объема',
    9990.00,
    '{"Объем": "32 ГБ", "Тип": "DDR4", "Частота": "3600 МГц", "Тайминги": "CL18", "Количество модулей": "2x16 ГБ"}'
  ),
  (
    'G.Skill Trident Z5 32GB DDR5',
    'Топовая память DDR5 нового поколения',
    15990.00,
    '{"Объем": "32 ГБ", "Тип": "DDR5", "Частота": "6000 МГц", "Тайминги": "CL30", "Количество модулей": "2x16 ГБ"}'
  ),
  
  -- SSD накопители
  (
    'Samsung 980 PRO 1TB',
    'Скоростной NVMe SSD для профессионалов',
    12990.00,
    '{"Объем": "1 ТБ", "Интерфейс": "NVMe PCIe 4.0", "Скорость чтения": "7000 МБ/с", "Скорость записи": "5000 МБ/с"}'
  ),
  (
    'WD Black SN850X 500GB',
    'Игровой SSD с высокой производительностью',
    7990.00,
    '{"Объем": "500 ГБ", "Интерфейс": "NVMe PCIe 4.0", "Скорость чтения": "7300 МБ/с", "Скорость записи": "4300 МБ/с"}'
  ),
  
  -- Блоки питания
  (
    'Corsair RM750e 750W',
    'Модульный блок питания 80+ Gold',
    9990.00,
    '{"Мощность": "750 Вт", "Сертификат": "80+ Gold", "Модульность": "Полностью модульный", "Вентилятор": "135 мм"}'
  ),
  (
    'be quiet! Pure Power 11 600W',
    'Тихий и надежный блок питания',
    7990.00,
    '{"Мощность": "600 Вт", "Сертификат": "80+ Gold", "Модульность": "Не модульный", "Уровень шума": "<20 дБ"}'
  ),
  
  -- Корпуса
  (
    'be quiet! Pure Base 500DX',
    'Тихий корпус с отличным охлаждением',
    8990.00,
    '{"Форм-фактор": "Mid-Tower", "Вентиляторы": "3x140мм", "Окно": "Закаленное стекло", "USB": "2x3.0, 1xType-C"}'
  ),
  (
    'Fractal Design Define 7',
    'Премиальный корпус для профессионалов',
    15990.00,
    '{"Форм-фактор": "Full-Tower", "Материал": "Сталь", "Шумоизоляция": "Да", "Максимум видеокарты": "440 мм"}'
  ),
  
  -- Мониторы
  (
    'ASUS TUF Gaming VG27AQ',
    '27" игровой монитор с G-Sync',
    29990.00,
    '{"Диагональ": "27 дюймов", "Разрешение": "2560x1440", "Частота": "165 Гц", "Матрица": "IPS", "Время отклика": "1 мс"}'
  ),
  (
    'Samsung Odyssey G5 32"',
    'Изогнутый игровой монитор большой диагонали',
    32990.00,
    '{"Диагональ": "32 дюйма", "Разрешение": "2560x1440", "Частота": "144 Гц", "Матрица": "VA", "Кривизна": "1000R"}'
  ),
  
  -- Периферия
  (
    'Logitech G PRO X Superlight',
    'Профессиональная игровая мышь',
    12990.00,
    '{"Тип": "Беспроводная", "Сенсор": "HERO 25K", "DPI": "25600", "Вес": "63 г", "Время работы": "70 часов"}'
  ),
  (
    'SteelSeries Apex Pro',
    'Механическая клавиатура с регулируемыми переключателями',
    18990.00,
    '{"Тип": "Механическая", "Переключатели": "OmniPoint", "Подсветка": "RGB", "Интерфейс": "USB", "Размер": "Full"}'
  );

-- Пример добавления товара в корзину
INSERT INTO cart_items (user_id, product_id, quantity)
VALUES
  (1, 1, 1), -- Иван добавил процессор
  (1, 4, 1), -- и видеокарту
  (2, 9, 2), -- Петр добавил память
  (2, 12, 1); -- и SSD